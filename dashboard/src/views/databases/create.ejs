<%- include('../partials/pageHeader', {
    title: t('databases:create.title'),
    titleIcon: 'bi-database-add',
    backLink: { href: '/databases', label: t('databases:title') }
}) %>

<div class="row justify-content-center">
    <div class="col-lg-8 col-xl-6">
        <div class="card">
            <div class="card-body">
                <form method="POST" action="/databases">
                    <%- csrfInput %>
                    <div class="mb-3">
                        <label for="name" class="form-label">
                            <%= t('databases:create.databaseName') %>
                            <%- include('../partials/help-icon', { text: t('databases:create.databaseNameHelp') }) %>
                        </label>
                        <input type="text" class="form-control" id="name" name="name"
                               pattern="[a-z0-9_]+" required
                               placeholder="<%= t('databases:create.databaseNamePlaceholder') %>">
                        <div class="form-text"><%= t('databases:create.databaseNameHint') %></div>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">
                            <%= t('databases:create.databaseType') %>
                            <%- include('../partials/help-icon', { text: t('databases:create.databaseTypeHelp') }) %>
                        </label>
                        <div class="row g-3">
                            <% dbTypes.forEach((dbType, index) => { %>
                                <div class="col-md-6">
                                    <div class="form-check card h-100 d-db-type-card">
                                        <div class="card-body">
                                            <input class="form-check-input" type="radio"
                                                   name="type" id="type-<%= dbType.id %>"
                                                   value="<%= dbType.id %>"
                                                   <%= index === 0 ? 'checked' : '' %>>
                                            <label class="form-check-label d-block" for="type-<%= dbType.id %>">
                                                <span class="badge <%= dbType.id === 'postgresql' ? 'bg-info-subtle' : 'bg-warning-subtle' %> mb-2">
                                                    <i class="<%= dbType.icon %>"></i> <%= dbType.name %>
                                                </span>
                                                <p class="text-muted small mb-1"><%= dbType.description %></p>
                                                <small class="text-muted">
                                                    Port: <%= dbType.port %> | Tool: <%= dbType.managementTool %>
                                                </small>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            <% }) %>
                        </div>
                    </div>

                    <div class="alert alert-info mb-4">
                        <i class="bi bi-info-circle"></i>
                        <strong><%= t('common:messages.noData', { defaultValue: 'Note' }) %>:</strong> <%= t('databases:create.autoUserNote', { defaultValue: 'A database user will be created automatically' }) %>:
                        <br>
                        <code><%= user.system_username %>_&lt;<%= t('databases:create.databaseNamePlaceholder') %>&gt;</code>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-plus-lg"></i> <%= t('databases:create.submit') %>
                        </button>
                        <a href="/databases" class="btn btn-outline-secondary">
                            <%= t('common:buttons.cancel') %>
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
.d-db-type-card {
    cursor: pointer;
    transition: border-color 0.2s, box-shadow 0.2s;
}
.d-db-type-card:hover {
    border-color: var(--d-primary);
}
.d-db-type-card:has(input:checked) {
    border-color: var(--d-primary);
    box-shadow: 0 0 0 3px var(--d-primary-subtle);
}
.d-db-type-card .form-check-input {
    position: absolute;
    top: 1rem;
    right: 1rem;
}
</style>
